<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>家庭便签</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app">
    <div id="role-select" class="role-select">
      <h1>欢迎来到家庭便签</h1>
      <p>请选择您的角色</p>
      <div class="role-buttons">
        <button class="role-btn father" onclick="selectRole('father')">
          👨 爸爸
          <span class="color-indicator"></span>
        </button>
        <button class="role-btn mother" onclick="selectRole('mother')">
          👩 妈妈
          <span class="color-indicator"></span>
        </button>
        <button class="role-btn son" onclick="selectRole('son')">
          👦 儿子
          <span class="color-indicator"></span>
        </button>
        <button class="role-btn daughter" onclick="selectRole('daughter')">
          👧 女儿
          <span class="color-indicator"></span>
        </button>
      </div>
    </div>

    <div id="main-app" class="main-app" style="display: none;">
      <header class="header">
        <h1>家庭便签</h1>
        <div class="header-right">
          <span id="current-role" class="role-badge"></span>
          <button class="btn-small" onclick="showSettings()">⚙️ 设置</button>
        </div>
      </header>

      <nav class="nav">
        <button class="nav-btn active" onclick="showTab('notes')">📝 公共便签</button>
        <button class="nav-btn" onclick="showTab('private')">🔒 私密日记</button>
        <button class="nav-btn" onclick="showTab('todo')">📅 待办</button>
      </nav>

      <div class="search-bar">
        <input type="text" id="search-input" placeholder="搜索便签..." onkeyup="searchNotes()">
        <button class="btn-search" onclick="searchNotes()">🔍</button>
      </div>

      <div class="content">
        <div id="notes-tab" class="tab-content">
          <button class="btn-primary" onclick="showNoteModal()">➕ 新建便签</button>
          <div id="notes-list" class="notes-list"></div>
        </div>

        <div id="private-tab" class="tab-content" style="display: none;">
          <button class="btn-primary" onclick="showNoteModal(true)">➕ 新建日记</button>
          <div id="private-list" class="notes-list"></div>
        </div>

        <div id="todo-tab" class="tab-content" style="display: none;">
          <div class="calendar-container">
            <div class="calendar-header">
              <button class="btn-small" onclick="prevMonth()">&#9664;</button>
              <h2 id="calendar-title"></h2>
              <button class="btn-small" onclick="nextMonth()">&#9654;</button>
            </div>
            <div class="calendar-weekdays">
              <div>日</div>
              <div>一</div>
              <div>二</div>
              <div>三</div>
              <div>四</div>
              <div>五</div>
              <div>六</div>
            </div>
            <div id="calendar-days" class="calendar-days"></div>
          </div>
        </div>
      </div>

      <div id="note-modal" class="modal" style="display: none;">
        <div class="modal-content">
          <span class="close" onclick="closeNoteModal()">&times;</span>
          <h2 id="modal-title">新建便签</h2>
          <form id="note-form">
            <input type="hidden" id="note-id">
            <div class="form-group">
              <label>标题</label>
              <input type="text" id="note-title" required>
            </div>
            <div class="form-group">
              <label>内容</label>
              <div class="editor-toolbar">
                <button type="button" onclick="formatText('bold')"><b>B</b></button>
                <button type="button" onclick="formatText('underline')"><u>U</u></button>
                <button type="button" onclick="formatText('h1')">H1</button>
                <button type="button" onclick="formatText('h2')">H2</button>
                <button type="button" onclick="formatText('h3')">H3</button>
                <select onchange="formatText('fontSize', this.value)">
                  <option value="">字号</option>
                  <option value="1">小</option>
                  <option value="3">中</option>
                  <option value="5">大</option>
                  <option value="7">特大</option>
                </select>
                <input type="color" id="font-color" onchange="formatText('foreColor', this.value)" title="字体颜色">
                <button type="button" onclick="document.getElementById('image-upload').click()">📷 图片</button>
                <input type="file" id="image-upload" accept="image/*" onchange="previewImage()" style="display: none;">
              </div>
              <div id="note-content" contenteditable="true" class="editor"></div>
              <div id="image-preview"></div>
            </div>
            <div class="form-group" id="color-picker-group">
              <label>便签颜色</label>
              <div class="color-picker-group" id="note-color-picker">
                <div class="color-option" data-color="" title="默认"></div>
                <div class="color-option red" data-color="red" title="红色"></div>
                <div class="color-option green" data-color="green" title="绿色"></div>
                <div class="color-option blue" data-color="blue" title="蓝色"></div>
                <div class="color-option yellow" data-color="yellow" title="黄色"></div>
                <div class="color-option purple" data-color="purple" title="紫色"></div>
                <div class="color-option orange" data-color="orange" title="橙色"></div>
                <div class="color-option pink" data-color="pink" title="粉色"></div>
                <div class="color-option teal" data-color="teal" title="青色"></div>
                <div class="color-option indigo" data-color="indigo" title="靛蓝"></div>
                <div class="color-option brown" data-color="brown" title="棕色"></div>
              </div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn-cancel" onclick="closeNoteModal()">取消</button>
              <button type="submit" class="btn-primary">保存</button>
            </div>
          </form>
        </div>
      </div>

      <div id="settings-modal" class="modal" style="display: none;">
        <div class="modal-content">
          <span class="close" onclick="closeSettings()">&times;</span>
          <h2>个人设置</h2>
          <div class="form-group">
            <label>切换角色</label>
            <button class="btn-primary" onclick="showSwitchRoleModal()">🔄 切换角色</button>
          </div>
          <div class="form-group">
            <label>密码管理</label>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
              <button class="btn-primary" id="set-password-btn" onclick="showSetPasswordFromSettings()">🔑 设置密码</button>
              <button class="btn-primary" id="change-password-btn" onclick="showChangePasswordModal()">🔐 修改密码</button>
            </div>
          </div>
          <div class="form-group">
            <label>快速切换</label>
            <div class="role-buttons">
              <button class="role-btn father" onclick="quickSwitchRole('father')">
                👨 爸爸
                <span class="color-indicator"></span>
              </button>
              <button class="role-btn mother" onclick="quickSwitchRole('mother')">
                👩 妈妈
                <span class="color-indicator"></span>
              </button>
              <button class="role-btn son" onclick="quickSwitchRole('son')">
                👦 儿子
                <span class="color-indicator"></span>
              </button>
              <button class="role-btn daughter" onclick="quickSwitchRole('daughter')">
                👧 女儿
                <span class="color-indicator"></span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="set-password-modal" class="modal" style="display: none;">
        <div class="modal-content">
          <span class="close" onclick="closeSetPasswordModal()">&times;</span>
          <h2>设置密码</h2>
          <p class="modal-hint">首次使用需要为该角色设置密码</p>
          <form id="set-password-form">
            <div class="form-group">
              <label>新密码</label>
              <div class="password-input-wrapper">
                <input type="password" id="set-new-password" required placeholder="至少8位，包含字母和数字">
                <button type="button" class="toggle-password" onclick="togglePassword('set-new-password')">👁️</button>
              </div>
            </div>
            <div class="form-group">
              <label>确认密码</label>
              <div class="password-input-wrapper">
                <input type="password" id="set-confirm-password" required placeholder="再次输入新密码">
                <button type="button" class="toggle-password" onclick="togglePassword('set-confirm-password')">👁️</button>
              </div>
            </div>
            <p id="set-password-error" class="error-message" style="color: #e74c3c; display: none;"></p>
            <div class="form-actions">
              <button type="button" class="btn-cancel" onclick="closeSetPasswordModal()">取消</button>
              <button type="submit" class="btn-primary">设置密码</button>
            </div>
          </form>
        </div>
      </div>

      <div id="verify-password-modal" class="modal" style="display: none;">
        <div class="modal-content">
          <span class="close" onclick="closeVerifyPasswordModal()">&times;</span>
          <h2 id="verify-modal-title">验证密码</h2>
          <p id="verify-modal-hint" class="modal-hint">请输入当前角色密码</p>
          <form id="verify-password-form">
            <input type="hidden" id="verify-target-role">
            <input type="hidden" id="verify-action">
            <div class="form-group">
              <label>密码</label>
              <div class="password-input-wrapper">
                <input type="password" id="verify-password" required placeholder="请输入密码">
                <button type="button" class="toggle-password" onclick="togglePassword('verify-password')">👁️</button>
              </div>
            </div>
            <p id="verify-password-error" class="error-message" style="color: #e74c3c; display: none;"></p>
            <div class="form-actions">
              <button type="button" class="btn-cancel" onclick="closeVerifyPasswordModal()">取消</button>
              <button type="submit" class="btn-primary">验证</button>
            </div>
          </form>
        </div>
      </div>

      <div id="change-password-modal" class="modal" style="display: none;">
        <div class="modal-content">
          <span class="close" onclick="closeChangePasswordModal()">&times;</span>
          <h2>修改密码</h2>
          <form id="change-password-form">
            <div class="form-group">
              <label>原密码</label>
              <div class="password-input-wrapper">
                <input type="password" id="change-old-password" required placeholder="请输入原密码">
                <button type="button" class="toggle-password" onclick="togglePassword('change-old-password')">👁️</button>
              </div>
            </div>
            <div class="form-group">
              <label>新密码</label>
              <div class="password-input-wrapper">
                <input type="password" id="change-new-password" required placeholder="至少8位，包含字母和数字">
                <button type="button" class="toggle-password" onclick="togglePassword('change-new-password')">👁️</button>
              </div>
            </div>
            <div class="form-group">
              <label>确认新密码</label>
              <div class="password-input-wrapper">
                <input type="password" id="change-confirm-password" required placeholder="再次输入新密码">
                <button type="button" class="toggle-password" onclick="togglePassword('change-confirm-password')">👁️</button>
              </div>
            </div>
            <p id="change-password-error" class="error-message" style="color: #e74c3c; display: none;"></p>
            <div class="form-actions">
              <button type="button" class="btn-cancel" onclick="closeChangePasswordModal()">取消</button>
              <button type="submit" class="btn-primary">修改密码</button>
            </div>
          </form>
        </div>
      </div>

      <div id="todo-modal" class="modal" style="display: none;">
        <div class="modal-content todo-modal-content">
          <span class="close" onclick="closeTodoModal()">&times;</span>
          <h2 id="todo-modal-title">编辑待办</h2>
          <p id="todo-modal-date" class="todo-date-display"></p>
          <form id="todo-form">
            <input type="hidden" id="todo-id">
            <input type="hidden" id="todo-date">
            <div class="form-group">
              <label>内容</label>
              <div class="todo-editor-toolbar">
                <button type="button" onclick="formatTodoText('bold')"><b>B</b></button>
                <button type="button" onclick="formatTodoText('underline')"><u>U</u></button>
              </div>
              <div id="todo-content" contenteditable="true" class="todo-editor"></div>
            </div>
            <div class="form-group">
              <label>颜色</label>
              <div class="color-picker-group" id="todo-color-picker">
                <div class="color-option" data-color="" title="默认"></div>
                <div class="color-option red" data-color="red" title="红色"></div>
                <div class="color-option green" data-color="green" title="绿色"></div>
                <div class="color-option blue" data-color="blue" title="蓝色"></div>
                <div class="color-option yellow" data-color="yellow" title="黄色"></div>
                <div class="color-option purple" data-color="purple" title="紫色"></div>
                <div class="color-option orange" data-color="orange" title="橙色"></div>
                <div class="color-option pink" data-color="pink" title="粉色"></div>
                <div class="color-option teal" data-color="teal" title="青色"></div>
                <div class="color-option indigo" data-color="indigo" title="靛蓝"></div>
                <div class="color-option brown" data-color="brown" title="棕色"></div>
              </div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn-cancel" onclick="closeTodoModal()">取消</button>
              <button type="button" class="btn-delete" id="todo-delete-btn" style="display: none;" onclick="deleteTodo()">删除</button>
              <button type="submit" class="btn-primary">保存</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
